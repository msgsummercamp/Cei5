<p-stepper [value]="currentStep">
  <p-step-list>
    <p-step [value]="1">Reservation Info</p-step>
    <p-step [value]="2">Flight Details</p-step>
    <p-step [value]="3">Connection Flights</p-step>
  </p-step-list>
  <p-step-panels>
    <p-step-panel [value]="1">
      <ng-template pTemplate="content" let-nextCallback="nextCallback">
        <p-card>
          <form [formGroup]="reservationForm" (ngSubmit)="onNext(nextCallback)">
            <h2>Reservation Info</h2>

            <p-floatlabel variant="on">
              <input
                pInputText
                id="reservationNumber"
                formControlName="reservationNumber"
              />
              <label for="reservationNumber">Reservation Number</label>
            </p-floatlabel>

            <p-floatlabel variant="on">
              <p-autocomplete
                id="departingAirport"
                formControlName="departingAirport"
                field="name"
                [dropdown]="true"
              />
              <label for="departingAirport">Departing Airport</label>
            </p-floatlabel>

            <p-floatlabel variant="on">
              <p-autocomplete
                id="destinationAirport"
                formControlName="destinationAirport"
                field="name"
                [dropdown]="true"
              />
              <label for="destinationAirport">Destination Airport</label>
            </p-floatlabel>

            <div class="step-actions">
              <p-button
                label="Next"
                severity="primary"
                (onClick)="onNext(nextCallback)"
                [disabled]="reservationForm.invalid"
              />
            </div>
          </form>
        </p-card>
      </ng-template>
    </p-step-panel>
    <p-step-panel [value]="2">
      <ng-template
        pTemplate="content"
        let-prevCallback="prevCallback"
        let-nextCallback="nextCallback"
      >
        <p-card>
          <app-case-form title="Flight Details" #mainFlightForm>
          </app-case-form>

          <div class="step-actions">
            <p-button
              label="Back"
              severity="secondary"
              (onClick)="onPrevious(prevCallback)"
            />
            <p-button
              label="Next"
              severity="primary"
              [disabled]="!isMainFlightValid(mainFlightForm)"
              (onClick)="onNextFromFlightDetails(nextCallback, mainFlightForm)"
            />
          </div>
        </p-card>
      </ng-template>
    </p-step-panel>
    <p-step-panel [value]="3">
      <ng-template
        pTemplate="content"
        let-prevCallback="prevCallback"
        let-nextCallback="nextCallback"
      >
        <p-card>
          @if (getActiveConnectionFlights().length === 0) {
          <p-message>No connection flights added yet.</p-message>
          } @if (getActiveConnectionFlights().length > 0) {
          <div class="connection-forms">
            @for (flight of connectionFlights; track $index; let i = $index) {
            @if (flight !== null) {
            <p-card class="connection-flight-card">
              <ng-template pTemplate="header">
                <div class="connection-header">
                  <p-button
                    label="Remove"
                    severity="danger"
                    (onClick)="removeConnectionFlight(i)"
                  >
                  </p-button>
                </div>
              </ng-template>

              <app-case-form
                [title]="'Connection Flight ' + (i + 1)"
                #connectionForm
              >
              </app-case-form>
            </p-card>
            } }
          </div>
          } @if (canAddMoreConnections()) {
          <div class="add-connection-section">
            <p-button
              label="Add Connection Flight"
              severity="secondary"
              (onClick)="addConnectionFlight()"
            >
            </p-button>
          </div>
          } @else {
          <p-message
            severity="warn"
            text="Maximum number of connection flights reached."
          >
          </p-message>
          }
          <div class="step-actions">
            <p-button
              label="Back"
              severity="secondary"
              (onClick)="onPrevious(prevCallback)"
            />
            <p-button
              label="Next"
              severity="primary"
              [disabled]="!areAllConnectionFlightsValid()"
              (onClick)="onNextFromConnectionFlights(nextCallback)"
            />
          </div>
        </p-card>
      </ng-template>
    </p-step-panel>
  </p-step-panels>
</p-stepper>
