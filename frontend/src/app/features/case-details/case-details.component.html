<div class="wrapper">
  @if (!loading && caseData) {
    <div class="case-details-container flex flex-wrap gap-4">
      <div class="flex-1 p-3 border-round bg-white">
        <h2>Case Details</h2>
        <p
          ><label><strong>Status: </strong></label>{{ caseData.status }}</p
        >
      </div>
      <div class="flex-1 p-3 border-round bg-white mt-2">
        <div>
          <h2>Additional Actions</h2>
        </div>
        <div style="width: 370px">
          <p-card
            header="{{ 'case-details.chat.comments' | translate }}"
            class="w-full"
            [styleClass]="'text-center'"
          >
            @if (loadingComments) {
              <p-progress-spinner />
            } @else {
              <div
                class="chat-messages"
                style="max-height: 300px; overflow-y: auto; max-width: 350px"
              >
                @for (comment of comments; track comment.id) {
                  @if (comment.userId === currentUserId) {
                    <p-card class="chat-message text-right" [styleClass]="'mb-2 bg-green-100'">
                      <strong>{{ comment.username }}</strong>
                      <span class="ml-2 text-xs text-muted">{{
                        comment.timestamp | date: 'short'
                      }}</span>
                      <div style="word-break: break-word; white-space: pre-line">{{
                        comment.text
                      }}</div>
                    </p-card>
                  } @else {
                    <p-card class="chat-message text-left" [styleClass]="'mb-2 bg-gray-100'">
                      <strong>{{ comment.username }}</strong>
                      <span class="ml-2 text-xs text-muted">{{
                        comment.timestamp | date: 'short'
                      }}</span>
                      <div style="word-break: break-word; white-space: pre-line">{{
                        comment.text
                      }}</div>
                    </p-card>
                  }
                }
              </div>
              <div class="chat-input mt-2 flex flex-row gap-2">
                <input
                  pInputText
                  type="text"
                  [(ngModel)]="newCommentText"
                  placeholder="{{ 'case-details.chat.type-message' | translate }}"
                  class="p-inputtext flex-grow-1"
                  [disabled]="postingComment"
                />
                <p-button
                  label="{{ 'case-details.chat.send' | translate }}"
                  (click)="postComment(currentUserId!)"
                  [disabled]="postingComment || !newCommentText.trim() || !currentUserId"
                  icon="pi pi-send"
                  class="p-button-sm"
                ></p-button>
              </div>
            }
            <p-message variant="simple" severity="success">{{
              'case-details.chat.message-length' | translate
            }}</p-message>
          </p-card>
        </div>
      </div>
    </div>
  } @else {
    <div class="loading-container">
      <p-progress-spinner />
    </div>
  }
</div>
