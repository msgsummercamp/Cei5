<div class="mt-8 mx-2 employee-case-table px-8 admin-table-container">
  <div class="add-container grid grid-nogutter">
    <p-button
      class="col-2 mt-3"
      size="large"
      [styleClass]="'text-blue-900 text-lg font-bold'"
      (onClick)="openEmployeeDialog()"
    >
      <i class="pi pi-user-plus" pButtonIcon></i>
      {{ 'admin-panel.addNewUser' | translate }}
    </p-button>
    <h1 class="text-center col-8">
      {{ 'admin-panel.title' | translate }}
    </h1>
  </div>
  <p-card>
    <h2 class="case-table-title text-center">
      {{ 'admin-panel.userList-title' | translate }}
    </h2>
    <div class="pt-3">
      <p-table
        #dt
        [value]="users"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[5, 7]"
        [loading]="loading"
        [customSort]="true"
        [scrollable]="true"
        scrollHeight="80vh"
        (sortFunction)="customSort($event)"
        [globalFilterFields]="['firstName', 'lastName', 'email', 'role']"
        [tableStyle]="{ 'min-width': '50rem' }"
      >
        <ng-template #header>
          <tr>
            <th>
              <div class="text-center">
                {{ 'admin-panel.name' | translate }}
                <p-columnFilter
                  type="text"
                  field="firstName"
                  display="menu"
                  [showAddButton]="false"
                  [showOperator]="false"
                />
              </div>
            </th>

            <th
              ><div class="text-center"
                >Email
                <p-columnFilter
                  type="text"
                  field="email"
                  display="menu"
                  [showAddButton]="false"
                  [showOperator]="false"
                /> </div
            ></th>

            <th>
              <div class="text-center">
                {{ 'admin-panel.role' | translate }}
                <p-columnFilter
                  field="role"
                  matchMode="equals"
                  display="menu"
                  [showAddButton]="false"
                  [showOperator]="false"
                  [showMatchModes]="false"
                  [showApplyButton]="false"
                  [showClearButton]="false"
                >
                  <ng-template #filter let-filter="filterCallback">
                    <p-select
                      [(ngModel)]="rolesFilterValue"
                      [options]="rolesOptions"
                      (onChange)="filter($event.value)"
                      (onClear)="onRolesFilterClear()"
                      [showClear]="true"
                      placeholder="{{ 'admin-panel.selectRole' | translate }}"
                      class="w-full"
                    >
                      <ng-template let-option #item>
                        <p-tag [value]="option.label" [severity]="'success'"></p-tag>
                      </ng-template>
                    </p-select>
                  </ng-template>
                </p-columnFilter>
              </div>
            </th>
            <th pSortableColumn="caseCount">
              <div class="text-center">
                {{ 'admin-panel.assignedCases' | translate }}
                <p-sortIcon field="caseCount"></p-sortIcon>
              </div>
            </th>
            <th> </th>
          </tr>
        </ng-template>
        <ng-template #body let-user>
          <tr>
            <td class="text-center">{{ concatenateName(user) }}</td>
            <td class="text-center">{{ user.email }}</td>
            <td class="text-center">
              <p-tag [value]="getRoleTranslation(user.role)" [severity]="'success'" />
            </td>
            <td class="text-center">{{ user.caseCount }}</td>
            <td
              ><p-button
                icon="pi pi-trash"
                severity="danger"
                [rounded]="true"
                [outlined]="true"
                (onClick)="deleteUser(user.id)"
              ></p-button
            ></td>
          </tr>
        </ng-template>
      </p-table>

      <app-employee-dialog
        [(visible)]="showEmployeeDialog"
        (onCancel)="closeEmployeeDialog()"
        (onSuccess)="onEmployeeDialogSuccess()"
      ></app-employee-dialog>

      <p-confirm-dialog
        header="{{ 'case-table.confirmation' | translate }}"
        icon="pi pi-exclamation-triangle"
      >
      </p-confirm-dialog>
    </div>
  </p-card>
</div>
